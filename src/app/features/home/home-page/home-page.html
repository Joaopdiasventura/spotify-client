<div class="layout" [class.drawer-open]="sidebarOpen()">
  <div class="sidebar-wrapper"><app-sidebar (closeEvent)="changeSidebar()"></app-sidebar></div>

  <div class="overlay" (click)="changeSidebar()"></div>

  <div class="main">
    <app-header (searchEvent)="onSearchChange($event)" (menuClick)="changeSidebar()"></app-header>

    <main class="content">
      <div class="container">
        @let loading = (loading$ | async); @let songs = (songs$ | async); @let label = (label$ |
        async); @if (!loading) {
        <h2 class="section-title">
          {{ label }}
        </h2>
        }

        <div class="grid-cards" #gridCards>
          @for (song of songs; track song; let i = $index) {
          <app-song-card
            [song]="song"
            [index]="i"
            [isPlaying]="isPlaying() && isCurrentSong(song)"
            (playEvent)="handleCardPlay($event)"
          ></app-song-card>
          } @if (loading) { @for (n of skeletons; track n) {
          <div class="song-skeleton">
            <div class="thumb-skel skeleton"></div>
            <div class="meta-skel">
              <div class="line w-60 skeleton"></div>
              <div class="line w-40 skeleton"></div>
              <div class="line w-48 skeleton"></div>
            </div>
            <div class="duration-skel line w-20 skeleton"></div>
          </div>
          } }
          <div #infiniteSentinel class="infinite-sentinel" aria-hidden="true"></div>
        </div>
      </div>
    </main>
  </div>

  @if (currentIndex() !== -1) {
    <app-player
      [playlist]="playerPlaylist()"
      [currentIndex]="currentIndex()"
      [isPlaying]="isPlaying()"
      (playEvent)="handlePlayerIndexChange($event)"
      (closeEvent)="onPlayerClose()"
      (loadMore)="handlePlayerLoadMore()"
    ></app-player>
  }
</div>
